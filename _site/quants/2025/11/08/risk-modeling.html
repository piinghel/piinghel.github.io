<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Forecasting Volatility with Panel Regressions</title>

  <!-- MathJax Config -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      }
    };
  </script>

  <!-- MathJax Scripts -->
  <script type="text/javascript" async
    src="https://polyfill.io/v3/polyfill.min.js?features=es6">
  </script>
  <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Forecasting Volatility with Panel Regressions | Quant Notes</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Forecasting Volatility with Panel Regressions" />
<meta name="author" content="anon" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction" />
<meta property="og:description" content="Introduction" />
<link rel="canonical" href="http://localhost:4002/quants/2025/11/08/risk-modeling.html" />
<meta property="og:url" content="http://localhost:4002/quants/2025/11/08/risk-modeling.html" />
<meta property="og:site_name" content="Quant Notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-11-08T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Forecasting Volatility with Panel Regressions" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"anon"},"dateModified":"2025-11-08T00:00:00+01:00","datePublished":"2025-11-08T00:00:00+01:00","description":"Introduction","headline":"Forecasting Volatility with Panel Regressions","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4002/quants/2025/11/08/risk-modeling.html"},"url":"http://localhost:4002/quants/2025/11/08/risk-modeling.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4002/feed.xml" title="Quant Notes" />
</head>
</head>

<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Quant Notes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
    <div class="wrapper">
      <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Forecasting Volatility with Panel Regressions</h1>
    <p class="post-meta"><time class="dt-published" datetime="2025-11-08T00:00:00+01:00" itemprop="datePublished">
        Nov 8, 2025
      </time><span class="reading-time"> • 25 min read</span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="introduction">Introduction</h2>

<p>I scale positions by volatility. And so should you.</p>

<p>The idea is simple: take smaller positions in volatile stocks, larger positions in stable ones. This keeps your portfolio risk roughly constant over time. It’s called volatility targeting, and it works.</p>

<p>But here’s the thing—to do this well, you need to <em>predict</em> future volatility. Not yesterday’s volatility, but what volatility will be over your holding period. Most people don’t spend much time on this. They use the last month’s realized vol and call it a day.</p>

<div style="border: 2px solid #333; padding: 1em; margin: 1em 0; background-color: #f9f9f9;">
<strong>The question:</strong> Is it worth spending time trying to predict volatility better?
</div>

<p>This post answers that question. Spoiler: yes, it’s worth it. Perfect volatility forecasts would add 3-4% annualized return to my strategy. Even modest improvements (correlation 0.70 → 0.86) should capture a good chunk of that.</p>

<h3 id="how-i-use-volatility-forecasts">How I Use Volatility Forecasts</h3>

<p>In my <a href="/quant/2024/12/15/low-volatility-factor.html">previous post on the low-volatility factor</a>, I built a long-short equity strategy. Position sizing combines two things: ML signal quality and volatility forecasts.</p>

<p>The allocation has two stages. First, I convert ML scores into initial weights $\alpha_i$. Better predictions get more capital on the long side; worse predictions get more capital on the short side (weights are always positive, just assigned to different legs).</p>

<p>Then I scale each position by volatility to target a fixed risk level:</p>

\[w_i = \alpha_i \cdot \min\left(\frac{\sigma_{\text{target}}}{\hat{\sigma}_i}, \lambda_{\max}\right)\]

<p>where:</p>
<ul>
  <li>\(\hat{\sigma}_i\) = volatility forecast for stock \(i\)</li>
  <li>\(\sigma_{\text{target}}\) = target volatility (20% annualized)</li>
  <li>\(\lambda_{\max} = 3\) = leverage cap</li>
</ul>

<p>The intuition: if a stock has half the target vol, I can take twice the position (up to the cap).</p>

<p>Finally, I apply constraints: 5% max per stock, total exposure ≤ 100%.</p>

<p>The key term is $\hat{\sigma}_i$. Currently I estimate it with simple moving averages—20-day rolling vol for longs, 60-day for shorts. When these forecasts are wrong, position sizing suffers:</p>

<ul>
  <li><strong>Underestimate vol</strong> → positions too large → deeper drawdowns</li>
  <li><strong>Overestimate vol</strong> → positions too small → missed returns</li>
</ul>

<h3 id="the-perfect-foresight-experiment">The Perfect Foresight Experiment</h3>

<p>To see what’s at stake, I run a backtest with perfect foresight. What if I knew the exact realized volatility for the next 21 days? This is obviously impossible in practice, but it shows the upper bound.</p>

<p>I test three scenarios:</p>
<ul>
  <li><strong>Current:</strong> Rolling volatility estimates (what I use now)</li>
  <li><strong>Perfect Long:</strong> Perfect foresight on the long leg only</li>
  <li><strong>Perfect:</strong> Perfect foresight on both legs (the upper bound)</li>
</ul>

<h3 id="long-short-performance">Long-Short Performance</h3>

<figure style="margin: 0.3em 0 0 0; padding: 0; line-height: 1;">
<iframe src="/assets/vol_impact/vol_impact_comparison.html" width="100%" height="420" frameborder="0" style="display: block; margin: 0; padding: 0; border: none; vertical-align: bottom;"></iframe>
<figcaption style="margin: 0.1em 0 0 0; padding: 0; font-size: 0.9em; line-height: 1.3; color: #888;">Figure 1: Long-short portfolio performance with different volatility estimation methods.</figcaption>
</figure>

<h3 id="individual-legs">Individual Legs</h3>

<figure style="margin: 0.25em 0 0 0; padding: 0; line-height: 1;">
<iframe src="/assets/vol_impact/long_short_legs_comparison.html" width="100%" height="410" frameborder="0" style="display: block; margin: 0; padding: 0; border: none; vertical-align: bottom;"></iframe>
<figcaption style="margin: 0.08em 0 0 0; padding: 0; font-size: 0.9em; line-height: 1.3; color: #888;">Figure 2: Long and short legs separately—where does the improvement come from?</figcaption>
</figure>

<h3 id="the-numbers">The Numbers</h3>

<p>Here’s the punchline. First, the long-short portfolios:</p>

<div style="overflow-x: auto;">
<table style="width: 100%; border-collapse: collapse; margin: 0.5em 0;">
<thead>
<tr>
<th style="padding: 0.6em; text-align: left; border-bottom: 2px solid #333;">Scenario</th>
<th style="padding: 0.6em; text-align: center; border-bottom: 2px solid #333;">Return</th>
<th style="padding: 0.6em; text-align: center; border-bottom: 2px solid #333;">Sharpe</th>
<th style="padding: 0.6em; text-align: center; border-bottom: 2px solid #333;">Max DD</th>
</tr>
</thead>
<tbody>
<tr style="background: #fafafa;">
<td style="padding: 0.6em; border-bottom: 1px solid #eee;">Current</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee;">12.3%</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee;">1.76</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee; color: #b00;">-16.2%</td>
</tr>
<tr style="background: #e8f5e9;">
<td style="padding: 0.6em; font-weight: bold; border-bottom: 1px solid #eee;">Perfect Long</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee; color: #2e7d32; font-weight: bold;">16.0%</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee; color: #2e7d32; font-weight: bold;">2.65</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee; color: #2e7d32;">-7.8%</td>
</tr>
<tr style="background: #f5f5f5;">
<td style="padding: 0.6em;">Perfect</td>
<td style="padding: 0.6em; text-align: center;">12.5%</td>
<td style="padding: 0.6em; text-align: center;">2.18</td>
<td style="padding: 0.6em; text-align: center; color: #2e7d32;">-7.8%</td>
</tr>
</tbody>
</table>
</div>
<p style="margin: 0.3em 0 1em 0; font-size: 0.9em; color: #888;">Table 1: Long-short portfolio performance (with fees). Perfect Long = perfect foresight on long leg only.</p>

<p>Wait—Perfect Long beats Perfect? Yes. When you give the short leg perfect foresight, it takes larger positions in low-vol stocks that happen to be bad shorts. The long leg is where better vol forecasts really pay off.</p>

<p>And here’s the leg-by-leg breakdown:</p>

<div style="overflow-x: auto;">
<table style="width: 100%; border-collapse: collapse; margin: 1em 0;">
<thead>
<tr>
<th style="padding: 0.6em; text-align: left; border-bottom: 2px solid #333;"></th>
<th colspan="3" style="padding: 0.6em; text-align: center; border-bottom: 2px solid #333; background: #f8f8f8;">Current</th>
<th colspan="3" style="padding: 0.6em; text-align: center; border-bottom: 2px solid #333; background: #e8f5e9;">Perfect Foresight</th>
</tr>
<tr style="font-size: 0.8em; color: #666;">
<th style="padding: 0.4em; border-bottom: 1px solid #ddd;"></th>
<th style="padding: 0.4em; text-align: center; border-bottom: 1px solid #ddd; background: #f8f8f8;">Return</th>
<th style="padding: 0.4em; text-align: center; border-bottom: 1px solid #ddd; background: #f8f8f8;">Sharpe</th>
<th style="padding: 0.4em; text-align: center; border-bottom: 1px solid #ddd; background: #f8f8f8;">Max DD</th>
<th style="padding: 0.4em; text-align: center; border-bottom: 1px solid #ddd; background: #e8f5e9;">Return</th>
<th style="padding: 0.4em; text-align: center; border-bottom: 1px solid #ddd; background: #e8f5e9;">Sharpe</th>
<th style="padding: 0.4em; text-align: center; border-bottom: 1px solid #ddd; background: #e8f5e9;">Max DD</th>
</tr>
</thead>
<tbody>
<tr>
<td style="padding: 0.6em; font-weight: bold; border-bottom: 1px solid #eee;">Long</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee; background: #fafafa;">13.1%</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee; background: #fafafa;">1.14</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee; background: #fafafa; color: #b00;">-29.7%</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee; background: #e8f5e9; color: #2e7d32; font-weight: bold;">17.1%</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee; background: #e8f5e9; color: #2e7d32; font-weight: bold;">1.92</td>
<td style="padding: 0.6em; text-align: center; border-bottom: 1px solid #eee; background: #e8f5e9; color: #2e7d32;">-14.1%</td>
</tr>
<tr>
<td style="padding: 0.6em; font-weight: bold;">Short</td>
<td style="padding: 0.6em; text-align: center; background: #fafafa;">0.7%</td>
<td style="padding: 0.6em; text-align: center; background: #fafafa;">0.07</td>
<td style="padding: 0.6em; text-align: center; background: #fafafa; color: #b00;">-29.3%</td>
<td style="padding: 0.6em; text-align: center; background: #e8f5e9;">3.8%</td>
<td style="padding: 0.6em; text-align: center; background: #e8f5e9;">0.42</td>
<td style="padding: 0.6em; text-align: center; background: #e8f5e9;">-24.3%</td>
</tr>
</tbody>
</table>
</div>
<p style="margin: 0.3em 0 1em 0; font-size: 0.9em; color: #888;">Table 2: Individual leg performance with Current vs Perfect volatility forecasts.</p>

<p>The long leg improves dramatically: +4% return, nearly double the Sharpe, half the drawdown. The short leg improves too, but it’s a smaller effect—it runs at lower leverage and benefits less from accurate position sizing.</p>

<h3 id="so-what">So What?</h3>

<p>The takeaway: perfect volatility forecasts on the long leg alone would boost Sharpe from 1.76 to 2.65. That’s huge. Obviously we can’t achieve perfect foresight, but it shows what’s at stake.</p>

<p>The rest of this post is about getting closer to that upper bound. Can we beat the simple rolling averages I currently use? Spoiler: yes. Global panel regressions with sector structure achieve 0.86 correlation with realized vol (vs 0.70 for moving averages). That should translate to meaningful alpha.</p>

<p><strong>What I test:</strong></p>
<ul>
  <li>Baselines: simple moving averages</li>
  <li>Per-asset regressions: one model per stock</li>
  <li>Per-sector: one model per sector</li>
  <li>Global: one model for all assets</li>
  <li>Global + sector dummies: shared dynamics, sector-specific levels</li>
</ul>

<p><strong>Structure:</strong></p>
<ol>
  <li>Data exploration</li>
  <li>Walk-forward methodology (no lookahead!)</li>
  <li>Step-by-step model comparison</li>
  <li>Robustness checks</li>
</ol>

<h2 id="data">Data</h2>

<p>Russell 1000 constituents, 1995–2024. After cleaning, that’s about 7 million date × asset observations. Roughly 1,000 stocks in the universe at any point.</p>

<h2 id="data-exploration">Data Exploration</h2>

<p>Before throwing regressions at the problem, let’s look at what we’re working with.</p>

<h3 id="volatility-distribution-by-sector">Volatility Distribution by Sector</h3>

<figure style="margin: 0.3em 0 1.5em 0; padding: 0; line-height: 1;">
<iframe src="/assets/vol_forecasting/sector_distribution.html" width="100%" height="750" frameborder="0" style="display: block; margin: 0; padding: 0; border: none; vertical-align: bottom;"></iframe>
<figcaption style="margin: 0.1em 0 0 0; padding: 0; font-size: 0.9em; line-height: 1.3; color: #888;">Figure 3: Volatility distribution by sector—box plots show median and quartiles, density curves show the full distribution.</figcaption>
</figure>

<p>Volatility varies a lot by sector. Median vol ranges from ~15% in Utilities to ~30% in Energy. Two things stand out:</p>

<ol>
  <li>Different sectors have structurally different volatility levels. This motivates adding sector dummies.</li>
  <li>The distribution is right-skewed (long right tail). This motivates testing log-space models.</li>
</ol>

<h3 id="feature-correlations">Feature Correlations</h3>

<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>Correlation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Composite volatility (5/21/63d avg)</td>
      <td>0.738</td>
    </tr>
    <tr>
      <td>EWM volatility (21d)</td>
      <td>0.715</td>
    </tr>
    <tr>
      <td>Rolling volatility (21d)</td>
      <td>0.696</td>
    </tr>
  </tbody>
</table>

<p style="margin: 0.3em 0 1em 0; font-size: 0.9em; color: #888;">Table 3: Feature correlations with 21-day forward volatility.</p>

<p>All volatility features are predictive. The composite (averaging multiple horizons) slightly outperforms single-horizon measures, motivating the use of multi-horizon features.</p>

<h2 id="walk-forward-methodology">Walk-Forward Methodology</h2>

<p>This is important: all predictions use strict day-by-day walk-forward testing. Train on the past 2 years, predict today. No lookahead bias—yesterday’s coefficients predict today.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Training:    Day t-504 ──────────────────── Day t-1
Prediction:                                          Day t
</code></pre></div></div>

<p>For each date, I estimate coefficients on the past 504 days, then apply them to today’s features. This is powered by <a href="https://github.com/azmyrajab/polars_ols">polars-ols</a>—a fast, Rust-based OLS implementation for Polars:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">polars</span> <span class="k">as</span> <span class="n">pl</span>
<span class="kn">import</span> <span class="n">polars_ols</span>  <span class="c1"># Registers least_squares namespace
</span>
<span class="n">feature_cols</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">X_feature_vol_5</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">X_feature_vol_21</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">X_feature_vol_63</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">X_feature_vol_126</span><span class="sh">"</span><span class="p">]</span>

<span class="c1"># Step 1: Estimate rolling coefficients (global model)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">with_columns</span><span class="p">(</span>
    <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">y_target_vol_21</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">least_squares</span><span class="p">.</span><span class="nf">rolling_ols</span><span class="p">(</span>
        <span class="o">*</span><span class="p">[</span><span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">feature_cols</span><span class="p">],</span>
        <span class="n">window_size</span><span class="o">=</span><span class="mi">504</span><span class="p">,</span>      <span class="c1"># 2-year rolling window
</span>        <span class="n">min_periods</span><span class="o">=</span><span class="mi">252</span><span class="p">,</span>      <span class="c1"># Start after 1 year
</span>        <span class="n">mode</span><span class="o">=</span><span class="sh">"</span><span class="s">coefficients</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="p">.</span><span class="nf">over</span><span class="p">(</span><span class="n">order_by</span><span class="o">=</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span>    <span class="c1"># Pool all assets (global model)
</span>    <span class="p">.</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">coefficients_raw</span><span class="sh">"</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Step 2: Lag coefficients by 1 day for out-of-sample predictions
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">with_columns</span><span class="p">(</span>
    <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">coefficients_raw</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                 <span class="c1"># Use yesterday's coefficients
</span>    <span class="p">.</span><span class="nf">over</span><span class="p">(</span><span class="n">order_by</span><span class="o">=</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">coefficients_oos</span><span class="sh">"</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Step 3: Generate predictions from lagged coefficients
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">with_columns</span><span class="p">(</span>
    <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">coefficients_oos</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="n">least_squares</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">feature_cols</span><span class="p">])</span>
    <span class="p">.</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">prediction</span><span class="sh">"</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">.shift(1)</code> in Step 2 is critical—it ensures predictions on day $t$ only use coefficients estimated through day $t-1$.</p>

<p><strong>What does <code class="language-plaintext highlighter-rouge">.predict()</code> do?</strong> The <code class="language-plaintext highlighter-rouge">coefficients_oos</code> column contains a struct with fitted coefficients (intercept + betas). The <code class="language-plaintext highlighter-rouge">.predict()</code> method computes:</p>

\[\hat{\sigma} = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_3 + \beta_4 X_4\]

<p>This is equivalent to writing it manually:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span>
    <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">coefficients_oos</span><span class="sh">"</span><span class="p">).</span><span class="n">struct</span><span class="p">.</span><span class="nf">field</span><span class="p">(</span><span class="sh">"</span><span class="s">const</span><span class="sh">"</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">coefficients_oos</span><span class="sh">"</span><span class="p">).</span><span class="n">struct</span><span class="p">.</span><span class="nf">field</span><span class="p">(</span><span class="sh">"</span><span class="s">X_feature_vol_5</span><span class="sh">"</span><span class="p">)</span> <span class="o">*</span> <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">X_feature_vol_5</span><span class="sh">"</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">coefficients_oos</span><span class="sh">"</span><span class="p">).</span><span class="n">struct</span><span class="p">.</span><span class="nf">field</span><span class="p">(</span><span class="sh">"</span><span class="s">X_feature_vol_21</span><span class="sh">"</span><span class="p">)</span> <span class="o">*</span> <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">X_feature_vol_21</span><span class="sh">"</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">coefficients_oos</span><span class="sh">"</span><span class="p">).</span><span class="n">struct</span><span class="p">.</span><span class="nf">field</span><span class="p">(</span><span class="sh">"</span><span class="s">X_feature_vol_63</span><span class="sh">"</span><span class="p">)</span> <span class="o">*</span> <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">X_feature_vol_63</span><span class="sh">"</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">coefficients_oos</span><span class="sh">"</span><span class="p">).</span><span class="n">struct</span><span class="p">.</span><span class="nf">field</span><span class="p">(</span><span class="sh">"</span><span class="s">X_feature_vol_126</span><span class="sh">"</span><span class="p">)</span> <span class="o">*</span> <span class="n">pl</span><span class="p">.</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">X_feature_vol_126</span><span class="sh">"</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">.predict()</code> shortcut keeps the code clean.</p>

<h2 id="target--evaluation">Target &amp; Evaluation</h2>

<h3 id="target-forward-realized-volatility">Target: Forward Realized Volatility</h3>

<p>The target is 21-day forward realized volatility:</p>

\[\sigma_{i,t}^{\text{fwd}} = \sqrt{\frac{252}{21} \sum_{k=1}^{21} r_{i,t+k}^2}\]

<p>where $r_{i,t}$ is the daily return of stock $i$ on day $t$. The factor $\sqrt{252}$ annualizes the volatility.</p>

<p>This target is observable and directly measurable—unlike GARCH’s latent conditional variance. Clean target, clean evaluation.</p>

<h3 id="evaluation-metrics">Evaluation Metrics</h3>

<p>I evaluate predictions using:</p>
<ul>
  <li><strong>RMSE:</strong> Root mean squared error</li>
  <li><strong>MAE:</strong> Mean absolute error</li>
  <li><strong>Correlation:</strong> Spearman rank correlation with realized volatility</li>
</ul>

<h2 id="feature-engineering">Feature Engineering</h2>

<p>Each feature is motivated by something we know about how volatility behaves.</p>

<h3 id="rolling-volatility">Rolling Volatility</h3>

<p>Volatility clusters. High-vol days follow high-vol days. This is the most robust finding in finance. Recent realized vol is the single best predictor of future vol.</p>

<p>For each stock, I compute rolling volatility at multiple horizons:</p>

\[\hat{\sigma}_{i,t}^{(w)} = \sqrt{\frac{252}{w} \sum_{k=0}^{w-1} r_{i,t-k}^2}\]

<p>with windows $w \in {5, 21, 63, 126}$ days:</p>
<ul>
  <li><strong>5-day:</strong> Captures very recent shocks (earnings, news)</li>
  <li><strong>21-day:</strong> Standard monthly volatility, balances noise and signal</li>
  <li><strong>63-day:</strong> Quarterly horizon, smooths out short-term noise</li>
  <li><strong>126-day:</strong> Semi-annual, provides mean-reversion anchor</li>
</ul>

<h3 id="asymmetric-features-why-not-egarch">Asymmetric Features (Why Not EGARCH?)</h3>

<p>Volatility responds asymmetrically to returns. Bad news increases vol more than good news reduces it—the “leverage effect.” EGARCH is the standard way to model this.</p>

<p>But EGARCH has problems for what we’re doing:</p>

<ol>
  <li>
    <p>No observable target. EGARCH models latent conditional variance. You can’t measure it directly—only infer it from the model. Our target (21-day realized vol) is directly observable.</p>
  </li>
  <li>
    <p>Can’t pool across assets. EGARCH is fit per asset. You can’t share parameters across stocks, so you’re back to the per-asset overfitting problem.</p>
  </li>
  <li>
    <p>Computationally expensive. MLE optimization for each stock, each day, in a rolling window? That’s millions of optimizations.</p>
  </li>
</ol>

<p>The alternative: I capture the leverage effect with explicit downside/upside volatility features:</p>

\[\hat{\sigma}_{i,t}^{\text{down}} = \sqrt{\frac{252}{w} \sum_{k=0}^{w-1} r_{i,t-k}^2 \cdot \mathbf{1}_{r_{i,t-k} &lt; 0}}\]

\[\hat{\sigma}_{i,t}^{\text{up}} = \sqrt{\frac{252}{w} \sum_{k=0}^{w-1} r_{i,t-k}^2 \cdot \mathbf{1}_{r_{i,t-k} \geq 0}}\]

<p>The downside volatility counts only negative return days; upside counts only positive days. If the leverage effect exists, the regression will learn a higher coefficient on downside vol than upside vol—and that’s exactly what we see in the coefficient heatmap.</p>

<p>This gives us:</p>
<ul>
  <li>Observable target (realized vol, not latent variance)</li>
  <li>Poolable (works in cross-sectional regression)</li>
  <li>Fast (just rolling sums, no optimization)</li>
  <li>Interpretable (downside coef &gt; upside coef = leverage effect)</li>
</ul>

<h3 id="sector-dummies">Sector Dummies</h3>

<p>Different sectors have structurally different vol levels. Utilities are stable. Energy is volatile. Tech sits somewhere in between. I add sector dummies (BICS Level 1) so the model can learn these level differences while sharing the dynamics across all assets.</p>

<h3 id="log-market-cap">Log Market Cap</h3>

<p>Small firms are more volatile than large firms. Less diversified revenue, higher leverage, lower liquidity, more idiosyncratic risk.</p>

<p>I include log market cap as a feature:</p>

\[\text{LogMktCap}_{i,t} = \log(\text{MarketCap}_{i,t})\]

<p>The log transformation handles the skewed distribution of market caps (a few mega-caps, many small-caps) and makes the relationship with volatility more linear.</p>

<h2 id="model-specification">Model Specification</h2>

<h3 id="the-regression">The Regression</h3>

<p>For each date $t$, I fit a cross-sectional Ridge regression:</p>

\[\sigma_{i,t}^{\text{fwd}} = \beta_0 + \sum_{j=1}^{J} \beta_j X_{i,t}^{(j)} + \sum_{s=1}^{S} \gamma_s D_{i,s} + \varepsilon_{i,t}\]

<p>where:</p>
<ul>
  <li>$X_{i,t}^{(j)}$ are volatility features (5d, 21d, 63d, 126d, downside, upside) and log market cap</li>
  <li>$D_{i,s}$ are sector dummies</li>
  <li>$\varepsilon_{i,t}$ is the error term</li>
</ul>

<h3 id="ridge-regularization">Ridge Regularization</h3>

<p>Volatility features at different horizons are highly correlated (~0.8+). OLS estimates become unstable. Ridge regression stabilizes them:</p>

\[\hat{\boldsymbol{\beta}} = \arg\min_{\boldsymbol{\beta}} \left\{ \sum_{i} \left( y_i - \mathbf{X}_i \boldsymbol{\beta} \right)^2 + \alpha \|\boldsymbol{\beta}\|_2^2 \right\}\]

<p>I use $\alpha = 1$. This shrinks coefficients toward zero without eliminating any feature.</p>

<h3 id="clipping--bounds">Clipping &amp; Bounds</h3>

<p>Volatility data can contain outliers—stocks that jump 10x during earnings or crash during liquidations. These extreme values corrupt coefficient estimates.</p>

<p><strong>Training:</strong> I clip volatility features and targets to [2.5%, 200%] during model training:</p>
<ul>
  <li>Values below 2.5% are unrealistic for daily-rebalanced portfolios (bid-ask spreads alone create this much noise)</li>
  <li>Values above 200% annualized volatility are tail events that shouldn’t drive regression weights</li>
  <li>Clipping during training prevents outliers from distorting coefficient estimates</li>
</ul>

<p><strong>Evaluation:</strong> All reported metrics (correlation, RMSE, MAE) are computed on <strong>raw, unclipped volatility</strong>. This gives an honest assessment of model performance on real data, including tail events.</p>

<p><strong>Predictions:</strong> I clip final predictions to [2%, 200%] for visualization in figures. This prevents nonsensical outputs (negative volatility, infinite leverage recommendations) and keeps plots readable. The metrics themselves are evaluated on raw volatility.</p>

<p><strong>Note:</strong> Performance on clipped volatility would be slightly higher (outliers are easier to predict when bounded), but the difference is small. I report raw metrics to be conservative.</p>

<h3 id="ensemble-subsampling">Ensemble Subsampling</h3>

<p>Instead of a single model, I run 3 models with offset estimation windows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Model 1: trained on days 0, 3, 6, 9, ...
Model 2: trained on days 1, 4, 7, 10, ...
Model 3: trained on days 2, 5, 8, 11, ...
</code></pre></div></div>

<p>Final prediction is the average:</p>

\[\hat{\sigma}_{i,t}^{\text{ensemble}} = \frac{1}{3} \sum_{m=1}^{3} \hat{\sigma}_{i,t}^{(m)}\]

<p>Each model sees slightly different data. Averaging reduces variance.</p>

<h2 id="results-step-by-step-model-comparison">Results: Step-by-Step Model Comparison</h2>

<p>The central question: should we fit a model per asset, per sector, or globally? Let me build up the answer step by step.</p>

<h3 id="step-1-baselines">Step 1: Baselines</h3>

<p>What most practitioners use:</p>

<ul>
  <li>Composite average: equal-weighted average of 5, 21, and 63-day rolling vol</li>
  <li>Weighted blend: 70% × 21-day vol + 30% × 252-day vol (RiskMetrics-style)</li>
</ul>

<p>These achieve correlations around 0.70. Here’s what the predictions look like:</p>

<figure style="margin: 0.3em 0 2.5em 0; padding: 0; line-height: 1;">
<iframe src="/assets/vol_forecasting/residuals_baseline.html" width="100%" height="420" frameborder="0" style="display: block; margin: 0; padding: 0; border: none; vertical-align: bottom;"></iframe>
<figcaption style="margin: 0.1em 0 0 0; padding: 0; font-size: 0.9em; line-height: 1.3; color: #888;">Figure 4: Predicted vs actual volatility for the weighted blend baseline.</figcaption>
</figure>

<p>The predictions follow the diagonal but with significant scatter. Can we do better by learning the weights from data instead of fixing them?</p>

<h3 id="step-2-per-asset-regression">Step 2: Per-Asset Regression</h3>

<p>First attempt: fit a separate model for each stock. Each asset gets its own coefficients estimated on its own 2-year history.</p>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>Correlation</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Baseline (weighted avg)</td>
      <td>0.70</td>
      <td>0.17</td>
    </tr>
    <tr>
      <td>Per-asset regression</td>
      <td>0.75</td>
      <td>0.15</td>
    </tr>
  </tbody>
</table>

<p style="margin: 0.3em 0 1em 0; font-size: 0.9em; color: #888;">Table 4: Per-asset regression vs baseline.</p>

<p>Correlation improves to 0.75. The regression learns better weights than fixed heuristics.</p>

<p>But there’s a problem: with only ~500 observations per stock in a 2-year window, coefficients are noisy. The model overfits to idiosyncratic patterns. Can we do better by sharing information?</p>

<h3 id="step-3-pooling-across-stocks">Step 3: Pooling Across Stocks</h3>

<p>Here’s the key insight: what if volatility dynamics are shared across assets? Mean reversion, clustering, the leverage effect—these should work similarly for Apple and Exxon.</p>

<p>I test two pooling levels:</p>

<ul>
  <li>Per-sector: one model per BICS sector (~700k obs/sector)</li>
  <li>Global: one model for all assets (~7M obs total)</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>Correlation</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Per-asset</td>
      <td>0.75</td>
      <td>0.15</td>
    </tr>
    <tr>
      <td>Per-sector</td>
      <td>0.84</td>
      <td>0.13</td>
    </tr>
    <tr>
      <td>Global</td>
      <td>0.85</td>
      <td>0.13</td>
    </tr>
  </tbody>
</table>

<p style="margin: 0.3em 0 1em 0; font-size: 0.9em; color: #888;">Table 5: Impact of pooling across stocks.</p>

<p>Both jump to 0.84-0.85—a 10-point improvement over per-asset. Pooling works. Volatility dynamics are indeed shared across assets. Estimating them on more data reduces noise.</p>

<p>This is bias-variance tradeoff in action. Per-asset models: low bias (flexible), high variance (noisy). Global models: slightly higher bias (same coefficients for all), much lower variance (millions of observations).</p>

<h3 id="step-4-adding-sector-structure">Step 4: Adding Sector Structure</h3>

<p>Global pooling assumes all stocks share identical dynamics. But we saw that volatility <em>levels</em> differ by sector (15% for Utilities, 30% for Energy).</p>

<p>Can we get the best of both worlds? Shared coefficients for dynamics, sector-specific intercepts for levels?</p>

<p>Add sector dummies to the global model:</p>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>Correlation</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Global</td>
      <td>0.85</td>
      <td>0.130</td>
    </tr>
    <tr>
      <td>Global + sector dummies</td>
      <td>0.86</td>
      <td>0.124</td>
    </tr>
  </tbody>
</table>

<p style="margin: 0.3em 0 1em 0; font-size: 0.9em; color: #888;">Table 6: Adding sector structure.</p>

<p>A further boost to 0.86. The dummies let the model learn that Energy stocks have higher baseline vol than Utilities, while still sharing the dynamics across all assets.</p>

<p>Here’s what the best model looks like compared to the baseline:</p>

<figure style="margin: 0.3em 0 2.5em 0; padding: 0; line-height: 1;">
<iframe src="/assets/vol_forecasting/residuals_best.html" width="100%" height="420" frameborder="0" style="display: block; margin: 0; padding: 0; border: none; vertical-align: bottom;"></iframe>
<figcaption style="margin: 0.1em 0 0 0; padding: 0; font-size: 0.9em; line-height: 1.3; color: #888;">Figure 5: Predicted vs actual volatility for the global + dummies model.</figcaption>
</figure>

<p>The predictions are much tighter around the diagonal. The improvement is visible.</p>

<h3 id="step-5-log-space-models">Step 5: Log-Space Models</h3>

<p>The volatility distribution is right-skewed. Log-transforming should normalize the target. Does it help?</p>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>Raw-Space</th>
      <th>Log-Space</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Global</td>
      <td>0.845</td>
      <td>0.849</td>
    </tr>
    <tr>
      <td>Global + dummies</td>
      <td>0.857</td>
      <td>0.860</td>
    </tr>
  </tbody>
</table>

<p style="margin: 0.3em 0 1em 0; font-size: 0.9em; color: #888;">Table 7: Raw-space vs log-space models.</p>

<p>Marginally better (~0.003). The difference is tiny. I stick with raw-space for interpretability—coefficients are directly in volatility units, easier to sanity-check.</p>

<h3 id="step-6-additional-risk-factors">Step 6: Additional Risk Factors</h3>

<p>Can we improve further with macro risk factors?</p>

<ul>
  <li>Market volatility factor: rolling 21-day vol of the market index</li>
  <li>Group Risk Factor (GRF): sector-level vol relative to long-run norm (AQR-style)</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>Correlation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Global + dummies</td>
      <td>0.857</td>
    </tr>
    <tr>
      <td>+ market factor</td>
      <td>0.855</td>
    </tr>
    <tr>
      <td>+ GRF</td>
      <td>0.844</td>
    </tr>
  </tbody>
</table>

<p style="margin: 0.3em 0 1em 0; font-size: 0.9em; color: #888;">Table 8: Adding macro risk factors.</p>

<p>Neither helps. In fact, they slightly hurt. Why? The asset-level vol features already capture this. If the market is volatile, individual stocks are volatile, and our features pick that up. Adding redundant factors just adds noise.</p>

<h3 id="summary">Summary</h3>

<figure style="margin: 0.3em 0 1.5em 0; padding: 0; line-height: 1;">
<iframe src="/assets/vol_forecasting/metrics_comparison.html" width="100%" height="650" frameborder="0" style="display: block; margin: 0; padding: 0; border: none; vertical-align: bottom;"></iframe>
<figcaption style="margin: 0.1em 0 0 0; padding: 0; font-size: 0.9em; line-height: 1.3; color: #888;">Figure 6: Comparison of all model variants across RMSE, MAE, correlation, and MAPE metrics.</figcaption>
</figure>

<table>
  <thead>
    <tr>
      <th>Step</th>
      <th>Model</th>
      <th>Correlation</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Baseline</td>
      <td>Moving averages</td>
      <td>0.70</td>
      <td>0.17</td>
    </tr>
    <tr>
      <td>+Regression</td>
      <td>Per-asset</td>
      <td>0.75</td>
      <td>0.15</td>
    </tr>
    <tr>
      <td>+Pooling</td>
      <td>Global</td>
      <td>0.85</td>
      <td>0.13</td>
    </tr>
    <tr>
      <td>+Structure</td>
      <td>Global + dummies</td>
      <td>0.86</td>
      <td>0.124</td>
    </tr>
    <tr>
      <td>+Log-space</td>
      <td>Global + dummies (log)</td>
      <td>0.86</td>
      <td>0.124</td>
    </tr>
    <tr>
      <td>+Risk factors</td>
      <td>Global + dummies + market</td>
      <td>0.86</td>
      <td>0.125</td>
    </tr>
  </tbody>
</table>

<p>The progression is clear: learning weights beats heuristics, pooling beats per-asset, sector structure squeezes out the last bit of signal. Log-space and macro factors don’t help.</p>

<h2 id="robustness--validation">Robustness &amp; Validation</h2>

<h3 id="window-sensitivity">Window Sensitivity</h3>

<p>I swept rolling windows from 6 months to 10 years. How sensitive are results to this choice?</p>

<figure style="margin: 0.3em 0 1.5em 0; padding: 0; line-height: 1;">
<iframe src="/assets/vol_forecasting/window_trends.html" width="100%" height="420" frameborder="0" style="display: block; margin: 0; padding: 0; border: none; vertical-align: bottom;"></iframe>
<figcaption style="margin: 0.1em 0 0 0; padding: 0; font-size: 0.9em; line-height: 1.3; color: #888;">Figure 7: Model performance across different rolling window sizes (126 to 2520 days).</figcaption>
</figure>

<p>Performance is stable between 1–3 years. Very short windows are noisier; very long windows lag regime changes. I use 504 days (2 years).</p>

<h3 id="regime-robustness">Regime Robustness</h3>

<p>Do models hold up when volatility spikes? Here’s performance bucketed by market vol regime:</p>

<figure style="margin: 0.3em 0 1.5em 0; padding: 0; line-height: 1;">
<iframe src="/assets/vol_forecasting/regime_analysis.html" width="100%" height="420" frameborder="0" style="display: block; margin: 0; padding: 0; border: none; vertical-align: bottom;"></iframe>
<figcaption style="margin: 0.1em 0 0 0; padding: 0; font-size: 0.9em; line-height: 1.3; color: #888;">Figure 8: Correlation by market volatility regime—low (&lt;20%), neutral (20-30%), high (&gt;30%).</figcaption>
</figure>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>Low (&lt;20%)</th>
      <th>Neutral (20-30%)</th>
      <th>High (&gt;30%)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Global + dummies</td>
      <td>0.79</td>
      <td>0.83</td>
      <td>0.87</td>
    </tr>
    <tr>
      <td>Global + log dummies</td>
      <td>0.79</td>
      <td>0.83</td>
      <td>0.87</td>
    </tr>
    <tr>
      <td>Per-sector</td>
      <td>0.79</td>
      <td>0.82</td>
      <td>0.85</td>
    </tr>
    <tr>
      <td>Per-asset</td>
      <td>0.67</td>
      <td>0.69</td>
      <td>0.76</td>
    </tr>
    <tr>
      <td>Baselines</td>
      <td>0.61-0.62</td>
      <td>0.62-0.66</td>
      <td>0.68-0.70</td>
    </tr>
  </tbody>
</table>

<p>A few observations:</p>

<ol>
  <li>
    <p>All models improve in high-vol regimes. When vol is elevated, it’s more persistent and easier to predict. During calm periods, vol is compressed and harder to differentiate.</p>
  </li>
  <li>
    <p>Global models maintain their edge across all regimes. The 10+ point gap vs per-asset holds whether markets are calm or stressed.</p>
  </li>
  <li>
    <p>Per-asset models suffer most in low-vol regimes. With less signal, the noisy estimates hurt more. Global pooling provides stability when there’s less to work with.</p>
  </li>
</ol>

<h3 id="coefficient-interpretability">Coefficient Interpretability</h3>

<figure style="margin: 0.3em 0 1.5em 0; padding: 0; line-height: 1;">
<iframe src="/assets/vol_forecasting/coefficient_heatmap.html" width="100%" height="550" frameborder="0" style="display: block; margin: 0; padding: 0; border: none; vertical-align: bottom;"></iframe>
<figcaption style="margin: 0.1em 0 0 0; padding: 0; font-size: 0.9em; line-height: 1.3; color: #888;">Figure 9: Rolling regression coefficients over time. Red = predicts higher vol, Blue = predicts lower vol.</figcaption>
</figure>

<p>The heatmap reveals which features drive predictions.</p>

<p>Most important features:</p>

<ol>
  <li>126-day vol (~0.5): Strongest positive predictor. Long-term vol acts as the mean-reversion anchor.</li>
  <li>63-day vol (~0.3): Second strongest. Bridges short-term noise and long-term structure.</li>
  <li>5-day vol (negative!): Surprisingly negative. This is mean-reversion—when short-term vol spikes above long-term, the model predicts it will come down.</li>
  <li>Log market cap (~-0.1): Negative as expected. Smaller firms are more volatile.</li>
</ol>

<p>The sector dummies tell a story:</p>

<ul>
  <li>Energy: huge spike in 2020 (COVID oil crash, negative prices). Also elevated during 2008 and 2014-2016.</li>
  <li>Financials: spike in 2008-2009 (GFC). The model learned Financials needed a higher vol intercept during the crisis.</li>
  <li>Technology: elevated in early 2000s (dot-com bust), moderate since.</li>
  <li>Utilities: consistently low. Defensive stocks live up to their reputation.</li>
</ul>

<p>Asymmetric features (downside/upside vol) both have small negative coefficients. The leverage effect is present but subtle—most asymmetry is already captured by the level dynamics.</p>

<h2 id="conclusion">Conclusion</h2>

<p>The final model: global Ridge regression with sector dummies, 2-year rolling window, 3-model ensemble.</p>

<table>
  <thead>
    <tr>
      <th>Component</th>
      <th>Choice</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Target</td>
      <td>21-day forward realized vol</td>
    </tr>
    <tr>
      <td>Features</td>
      <td>Rolling vol (5/21/63/126d), downside/upside vol, log market cap, sector dummies</td>
    </tr>
    <tr>
      <td>Model</td>
      <td>Ridge regression (α=1)</td>
    </tr>
    <tr>
      <td>Estimation</td>
      <td>2-year rolling window, 3-model ensemble</td>
    </tr>
    <tr>
      <td>Pooling</td>
      <td>Global (all assets)</td>
    </tr>
    <tr>
      <td>Implementation</td>
      <td>polars-ols for fast rolling regressions</td>
    </tr>
  </tbody>
</table>

<p>The key insight: volatility dynamics are shared across assets. Mean reversion, clustering, the leverage effect—they work the same way for Apple and Exxon. Per-asset models waste data chasing idiosyncratic noise. Global models with sector structure extract signal efficiently.</p>

<p>We started with the question: is it worth predicting volatility better? The answer is yes. Perfect foresight would boost Sharpe from 1.76 to 2.65. We can’t achieve perfect foresight, but improving correlation from 0.70 to 0.86 should capture a meaningful chunk of that improvement.</p>

<h2 id="whats-next">What’s Next</h2>

<p>ML models (LightGBM, neural nets). Can they beat these structured regressions? The linear model can’t capture interactions—for example, how 21-day vol might predict forward vol differently for Energy vs Utilities. Tree-based models can discover these automatically. That’s the next experiment.</p>

<h2 id="things-to-work-on">Things to Work On</h2>

<p>A few things I want to improve:</p>

<p>Heatmap interpretation. I sometimes get the interpretation wrong. The red/blue color coding and temporal patterns need clearer explanation. This is on my list.</p>

<p>Computational performance. <a href="https://github.com/azmyrajab/polars_ols">polars-ols</a> is <em>incredibly</em> fast. Rolling regression every day—refitting on a 504-day window, shifting coefficients, refitting again. Millions of regressions across thousands of assets over 20+ years. Full model run takes ~30 seconds. The Rust-based implementation makes this feasible.</p>

<p>EGARCH testing. I mentioned EGARCH is slow, but I haven’t actually benchmarked the <code class="language-plaintext highlighter-rouge">arch</code> package myself. If someone tells me it’s worth testing, I’ll give it a shot. I don’t know everything.</p>

  </div>

  <nav class="post-navigation"><div class="post-nav-prev">
        <span class="post-nav-label">Previous</span>
        <a href="/quants/2025/05/10/rebalancing-luck.html">Reducing Rebalancing Timing Risk with Tranching</a>
      </div></nav><a class="u-url" href="/quants/2025/11/08/risk-modeling.html" hidden></a>
</article>

    </div>
  </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="http://localhost:4002/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">anon</li>
          
        </ul>
      </div>
      <div class="footer-col">
        <p>Systematic trading and data science things.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
